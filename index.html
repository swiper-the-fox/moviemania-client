<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-signin-client_id" content="845818014828-8500f37c1frc96sraq1l8bsc9hdim2s3.apps.googleusercontent.com">
    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.5.9/dist/css/uikit.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <title>ðŸŽ¬moviemaniaðŸŽž</title>
</head>
<body>
    <!-- LOGIN - PAGE -->
    <section id="login-page">
        <div class="bg-video">
            <video class="bg-video-content" autoplay muted loop>
                <source src="assets/video.mp4" type="video/mp4">
                    not supported
            </video>
        </div>
        <div class="center">
            <h1 style="margin-bottom: 3rem;" class="welcome">ðŸŽ¬moviemaniaðŸŽž</h1>
            <form id="form-login">
                <div class="uk-margin">
                    <div class="uk-inline">
                        <span class="uk-form-icon" uk-icon="icon: user"></span>
                        <input id="email" class="uk-input" type="email" placeholder="email here">
                    </div>
                </div>
            
                <div class="uk-margin">
                    <div class="uk-inline">
                        <span class="uk-form-icon uk-form-icon-flip" uk-icon="icon: lock"></span>
                        <input id="password" class="uk-input" type="password" placeholder="password here">
                    </div>
                </div>
                <button type="submit" class="login-btn uk-button uk-button-primary">Login</button>
                
            </form><br>            
            <div class="g-signin2" data-onsuccess="onSignIn"></div>
        </div>
    </section>

    <!-- MAIN PAGE -->
    <section id="main-page">
        <nav class="uk-navbar-container navbar-custom" uk-navbar>

            

            <div class="uk-navbar-left">
        
                <ul class="uk-navbar-nav">
                    <li>
                        <a href="#"><i class="uk-form-icon" uk-icon="icon: video-camera"></i></a>
                    </li>
                    <li><a href="#">MovieboxðŸ—ƒ</a></li>
                </ul>
        
            </div>
            <div class="uk-navbar-right">
        
                <ul class="uk-navbar-nav">
                    <li>
                        <a href="#" id="btn-logout">Logout</a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- HOME -SECTION -->

        <section id="home-page">

            <!-- CARD -->
            <div class="card-custom uk-card uk-card-default uk-card-hover uk-card-body">
                <i class="bookmark far fa-plus-square"></i>
                <img src="https://images.unsplash.com/photo-1587613753310-0ba642887227?ixlib=rb-1.2.1&q=85&fm=jpg&crop=entropy&cs=srgb&ixid=eyJhcHBfaWQiOjE0MTc4MH0" alt="image">
            </div>
            <!-- END MOVIE CARD -->

            <!-- TOLONG BUATKAN CARD UNTUK QUOTES -->
            <div id="quotes">
                <div class="row">
                    <div class="col-lg-6 mx-auto">
        
                        <!-- START BLOCKQUOTE -->
                        <blockquote class="blockquote blockquote-custom bg-white p-5 shadow rounded">
                            <div class="blockquote-custom-icon bg-info shadow-sm"><i class="fa fa-quote-left text-white"></i></div>
                                <p class="mb-0 mt-2 font-italic">"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod  tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo"</p>
                        </blockquote>
                        <!-- END BLOCKQUOTE -->
                    </div>
                </div>
            </div>
            <!-- TOLONG BUATKAN CARD UNTUK QUOTES -->

        </section>

        <!-- GALLERY - SECTION -->

        <section id="my-movie-page">
            
            <!-- CARD -->
            <div class="card-custom uk-card uk-card-default uk-card-hover uk-card-body">
                <i class="trash far fa-minus-square"></i>
                <img src="https://images.unsplash.com/photo-1587613753310-0ba642887227?ixlib=rb-1.2.1&q=85&fm=jpg&crop=entropy&cs=srgb&ixid=eyJhcHBfaWQiOjE0MTc4MH0" alt="image">
            </div>

        </section>
    </section>
    
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.5.4/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.5.4/dist/js/uikit-icons.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script>
        function showQuotes() {
            $.ajax({
                url: 'http://ron-swanson-quotes.herokuapp.com/v2/quotes',
                method: 'GET',
                headers: {
                    access_token: localStorage.getItem('access_token')
                }
            })
            .done(response => {
                $("#quotes").empty()
                $("#quotes").append(`${response}`)
            })
            .fail((xhr, textStatus) => {
                console.log(xhr)
            })
        }

        function showLoginPage(){
            $('#login-page').show()
            $('#main-page').hide()
        }

        function showMainPage(){
            $('section').hide()
            // $('#login-page').hide()
            $('#home-page').show()
            $('#main-page').show()
            fetchAllPhoto()
            showQuotes()
            fetchNewsapi()
        }
        function login(){
            const email = $('#email').val()
            const password = $('#password').val()
            $.ajax({
                url: 'http://localhost:3000/login',
                method: 'POST',
                data:{
                    email,
                    password
                    }
            })
            .done(response => {
                localStorage.setItem('access_token', response.access_token)
                showMainPage()
            })
            .fail(xhr => {
                console.log(xhr)
            })
            .always(() => {
                $('#email').val("")
                $('#password').val("")
            })
            // $('#form-login').on('submit', (e)=>{
            //     e.preventDefault()
            // })
        }

        function register() {
            const email = $('#email-register').val()
            const password = $('#password-register').val()
            $.ajax({
                url: 'http://localhost:3000/register',
                method: 'POST',
                data: {
                    email,
                    password
                }
            })
            .done(response => {
                showLoginPage()
            })
            .fail(xhr => {
                console.log(xhr)
            })
            .always(() => {
                $('#email-register').val("")
                $('#password-register').val("")
            })
        }

        function fetchAllPhoto(){
            $.ajax({
                method:'GET',
                url:'http://localhost:3000/photos',
                headers:{
                    access_token: localStorage.getItem('access_token')
                }
            })
                .done(response =>{
                    $('#my-movie-page').empty()
                    console.log(response);
                    response.result.forEach((e)=>{
                        $('#my-movie-page').append(`
                        <div class="card-custom uk-card uk-card-default uk-card-hover uk-card-body">
                            <i class="bookmark far fa-minus-square"></i>
                            <img src="${e.imageUrl}" alt="image">
                        </div>
                        `)
                    })
                })
                .fail(xhr => console.log(xhr))
        }


        $(document).ready(function(){
            // $('section').show()
            // showLoginPage()
            // $('#form-login').on('submit', (e)=>{
            //     e.preventDefault()
            //     login()
            // })
            if(localStorage.getItem('access_token')){
                showMainPage()
                $('section').show()
                
            }else{
                showLoginPage()
            }
            $('#btn-logout').on('click', (e)=>{
                localStorage.removeItem('access_token')
                showLoginPage()
            })

        })
        function onSignIn(googleUser) {
            let id_token = googleUser.getAuthResponse().id_token;
            console.log(id_token);
            $.ajax({
                url:'http://localhost:3000/googleLogin',
                method: 'POST',
                data:{
                    access_token: id_token
                }
            })
                .done(res=>{
                    console.log('googlelogin');
                    localStorage.setItem('access_token',res.access_token)
                    showMainPage()
                })
                .fail(err=>{
                    console.log(err);
                })
        }
        function fetchNewsapi(){
            console.log('fetchnews');
            $.ajax({
                url:'http://localhost:3000/movies/newsapi',
                method: 'GET',
                headers:{
                    access_token: localStorage.getItem('access_token')
                }
            })
                .done(res=>{
                    console.log('newsapi');
                    res.articles.forEach(el=>{
                        console.log(el.author);
                        console.log(el.title);
                        console.log(el.content);
                        console.log(el.description);
                        console.log(el.url);
                        console.log(el.urlToImage);
                    })
                })
                .fail(err=>{
                    console.log('errnewsapi');
                    console.log(err);
                })
        }
    </script>
</body>
</html>